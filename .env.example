# AUS Property Intelligence DB - Environment Configuration
# Copy this file to .env.local and fill in your values
# Never commit .env.local to version control

# ============================================================================
# DATABASE
# ============================================================================
# Main PostgreSQL database URL with credentials
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/aus_property_db

# Optional replica database for read scaling
DATABASE_REPLICA_URL=postgresql://postgres:postgres@localhost:5432/aus_property_db_replica

# Database connection pool settings
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=20
DATABASE_CONNECTION_TIMEOUT_MS=5000

# ============================================================================
# REDIS
# ============================================================================
# Primary Redis connection for caching
REDIS_URL=redis://localhost:6379

# Separate queue database to isolate cache from jobs
REDIS_QUEUE_URL=redis://localhost:6379/1

# Redis connection timeout (ms)
REDIS_TIMEOUT_MS=3000

# ============================================================================
# APPLICATION CORE
# ============================================================================
# Environment: development, staging, production
NODE_ENV=development
APP_ENV=local

# API Server Configuration
API_PORT=3001
API_HOST=http://localhost:3001
API_CORS_ORIGIN=http://localhost:3000

# Frontend URL (for redirects, CORS, etc.)
WEB_URL=http://localhost:3000

# ============================================================================
# AUTHENTICATION & SECURITY
# ============================================================================
# JWT Configuration
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRY=7d
JWT_REFRESH_SECRET=your-refresh-token-secret-change-in-production
JWT_REFRESH_EXPIRY=30d

# Magic Link Configuration (passwordless auth)
MAGIC_LINK_SECRET=your-magic-link-secret-change-in-production
MAGIC_LINK_EXPIRY=1h

# Rate Limiting
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# Session Configuration
SESSION_TIMEOUT_MS=86400000
SESSION_REFRESH_AFTER_MS=43200000

# ============================================================================
# OAUTH / THIRD-PARTY AUTH
# ============================================================================
# Google OAuth (optional, for social login)
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_CALLBACK_URL=http://localhost:3001/auth/google/callback

# GitHub OAuth (optional)
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=

# ============================================================================
# EMAIL & NOTIFICATIONS
# ============================================================================
# SendGrid (primary email service)
SENDGRID_API_KEY=
EMAIL_FROM=noreply@auspropdb.com
EMAIL_FROM_NAME=AUS Property Intelligence

# SMTP Fallback (if SendGrid unavailable)
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM=

# Email Templates Path (relative to project root)
EMAIL_TEMPLATES_DIR=./apps/api/src/modules/notifications/templates

# ============================================================================
# GEOLOCATION & MAPPING
# ============================================================================
# Mapbox (primary mapping/geocoding provider)
MAPBOX_API_KEY=
MAPBOX_PUBLIC_TOKEN=

# Google Maps (optional backup for geocoding)
GOOGLE_MAPS_API_KEY=

# Preferred geocoding provider: mapbox | google
GEOCODE_PROVIDER=mapbox

# Geolocation Settings
GEOLOCATION_MAX_DISTANCE_KM=50
GEOLOCATION_PRECISION=suburb

# ============================================================================
# EXTERNAL & THIRD-PARTY SERVICES
# ============================================================================
# OpenTelemetry Collector (for distributed tracing)
OPENTELEMETRY_COLLECTOR_URL=http://localhost:4317

# Sentry (error tracking and performance monitoring)
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_SAMPLE_RATE=0.1

# ============================================================================
# LOGGING & OBSERVABILITY
# ============================================================================
# Log Level: debug, info, warn, error
LOG_LEVEL=info

# Enable detailed logging
DEBUG=app:*

# Enable distributed tracing
ENABLE_TRACING=false

# Enable performance monitoring
ENABLE_PERFORMANCE_MONITORING=true

# Log File Paths
LOG_DIR=./logs
LOG_MAX_FILES=30
LOG_MAX_SIZE=20m

# ============================================================================
# FILE STORAGE
# ============================================================================
# AWS S3 Configuration (for document/image storage)
AWS_S3_BUCKET=aus-property-db-assets
AWS_S3_REGION=ap-southeast-2
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# Upload Settings
UPLOAD_MAX_FILE_SIZE_MB=10
UPLOAD_ALLOWED_TYPES=jpg,jpeg,png,pdf,docx
STORAGE_PATH=./public/uploads

# ============================================================================
# DATA CONNECTORS & SCRAPERS
# ============================================================================
# Connector Rate Limiting
CONNECTOR_RATE_LIMIT_PER_MINUTE=60
CONNECTOR_TIMEOUT_MS=30000

# RealEstate.com.au
REALESTATE_AU_API_KEY=
REALESTATE_AU_ENABLE=true

# Domain.com.au
DOMAIN_API_KEY=
DOMAIN_ENABLE=false

# Data Crawling
CRAWLER_ENABLED=true
CRAWLER_SCHEDULE=0 */6 * * *
CRAWLER_MAX_RETRIES=3
CRAWLER_BATCH_SIZE=50

# User Agent
USER_AGENT=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 AUS Property Intelligence DB

# ============================================================================
# BACKGROUND JOBS & QUEUE
# ============================================================================
# Bull Queue Concurrency
BULL_CONCURRENCY_DEFAULT=5
BULL_CONCURRENCY_CRAWL=3
BULL_CONCURRENCY_DEDUPE=10
BULL_CONCURRENCY_GEO=10

# Job Timeout (ms)
BULL_JOB_TIMEOUT_MS=300000

# Job Retention (days)
BULL_JOB_RETENTION_DAYS=7

# Recurring Job Schedules (cron format)
CRON_CRAWL=0 */6 * * *
CRON_DEDUPE=0 2 * * *
CRON_GEO_ENRICH=0 3 * * *
CRON_ALERTS=*/15 * * * *
CRON_CLEANUP=0 4 * * 0

# ============================================================================
# DATA RETENTION & COMPLIANCE
# ============================================================================
# Data Retention
HISTORICAL_DATA_RETENTION_DAYS=730
AUDIT_LOG_RETENTION_DAYS=365
SOFT_DELETE_ENABLED=true

# Compliance Flags
GDPR_ENABLED=true
PRIVACY_ACT_ENABLED=true
ENFORCE_ROBOTS_TXT=true
ENFORCE_TERMS_OF_SERVICE=true
RESPECT_X_ROBOTS_HEADER=true

# Contact for Abuse
ABUSE_CONTACT_EMAIL=abuse@auspropdb.com

# ============================================================================
# FEATURE FLAGS
# ============================================================================
# Core Features
ENABLE_MULTI_SOURCE_DEDUP=true
ENABLE_GEO_ENRICHMENT=true
ENABLE_PRICE_PREDICTION=false
ENABLE_ML_MODELS=false
ENABLE_ALERTS=true
ENABLE_WATCHLIST=true

# ============================================================================
# ANALYTICS
# ============================================================================
# Google Analytics
GOOGLE_ANALYTICS_ID=
GOOGLE_ANALYTICS_ENABLED=false

# Amplitude
AMPLITUDE_API_KEY=
AMPLITUDE_ENABLED=false

# ============================================================================
# DEVELOPMENT ONLY
# ============================================================================
# Database Seeding
DATABASE_SEED_ON_STARTUP=false

# API Documentation
SWAGGER_ENABLED=true
SWAGGER_THEME=dark

# Request Logging
LOG_HTTP_REQUESTS=true

# CORS Settings
CORS_ENABLED=true

# Bypass Authentication (NEVER in production!)
BYPASS_AUTH=false
